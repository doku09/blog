# ✏️ 학습내용

## 파일 입출력과 성능 최적화4 - Buffered 스트림 읽기
```java
public class ReadFileV3 {
    public static void main(String[] args) throws IOException {
        FileInputStream fis = new FileInputStream(BufferedConst.FILE_NAME);
        BufferedInputStream bis = new BufferedInputStream(fis, BUFFER_SIZE);
        long startTime = System.currentTimeMillis();
    
        int fileSize = 0;
        int data;
        while((data = bis.read()) != -1) {
            fileSize++;
        }
    
    
        long endTime = System.currentTimeMillis();
        System.out.println("File created: " + FILE_NAME);
        System.out.println("File size: " + fileSize/1024/1024 + "MB") ;
        System.out.println("Time taken: " + (endTime - startTime) + "ms") ;
    }
}
```

## 파일 입출력과 성능 최적화5 - 한 번에 쓰기
```java
public class CreateFileV4 {
    public static void main(String[] args) throws IOException {
        FileOutputStream fos = new FileOutputStream(FILE_NAME);
        long startTime = System.currentTimeMillis();
    
        byte[] buffer = new byte[FILE_SIZE];
        for (int i = 0; i < FILE_SIZE; i++) {
            buffer[i] = 1;
        }
        fos.write(buffer);
        fos.close();
        long endTime = System.currentTimeMillis();
    
        System.out.println("File created: " + FILE_NAME);
        System.out.println("File size: " + FILE_SIZE/1024/1024 + "MB") ;
        System.out.println("Time taken: " + (endTime - startTime) + "ms") ;
    }
}
```
**한번에 읽기**
```java
public class ReadFileV4 {
    public static void main(String[] args) throws IOException {
        FileInputStream fis = new FileInputStream(BufferedConst.FILE_NAME);
        long startTime = System.currentTimeMillis();
    
        byte[] bytes = fis.readAllBytes();
        fis.close();
    
        long endTime = System.currentTimeMillis();
        System.out.println("File created: " + FILE_NAME);
        System.out.println("File size: " + bytes.length / 1024 / 1024 + "MB") ;
        System.out.println("Time taken: " + (endTime - startTime) + "ms") ;
    }
}
```

## 정리
+ 파일의 크기가 크지 않아서, 메모리 사용에 큰 영향을 주지 않는다면 쉽고 빠르게 한 번에 처리하자. 
+ 성능이 중요하고 큰 파일을 나누어 처리해야한다면, 버퍼를 직접 다루자.
+ 성능이 크게 중요하지 않고, 버퍼 기능이 필요하면 BufferedXxx를 사용하자.
  + BufferedXxx는 동기화 코드가 들어있어서 스레드 안전하지만, 약간의 성능 저하가 있다.


# I/O 기본2
## 문자 다루기1 - 시작
```java
public class ReaderWriterMainV1 {
  public static void main(String[] args) throws IOException {
      String writeString = "ABC";
      // 문자 - byte UTF-8 인코딩
      byte[] writeBytes = writeString.getBytes(UTF_8);
      System.out.println("write String: " + writeString);
      System.out.println("write bytes: " + Arrays.toString(writeBytes));
  
      // 파일에 쓰기
      FileOutputStream fos = new FileOutputStream(FILE_NAME);
      fos.write(writeBytes);
      fos.close();
  
      // 파일에서 읽기
      FileInputStream fis = new FileInputStream(FILE_NAME);
      byte[] readBytes = fis.readAllBytes();
      fis.close();
  
      // byte -> String UTF-8 디코딩
      String readString = new String(readBytes, UTF_8);
  
      System.out.println("read bytes: " + Arrays.toString(readBytes));
      System.out.println("read String: " + readString);
  }
}
```
여기서 핵심은 스트림은 byte만 사용할 수 있으므로, String과 같은 문자는 직접 전달할수없다. 개발자는 번거롭게 인코딩과 디코딩을 반복해야한다. 누군가 이런 변환기능을 개발하지 않았을까?

## 문자 다루기2 - 스트림을 문자로
+ OutputStreamWriter: 스트림에 byte대신에 문자를 저장한다.
+ InputStreamReader: 스트림에 byte대신에 문자를 읽을 수 있게 지원한다.

기본 전제는 컴퓨터는 문자를 읽을 수 없다는 것이다. 무조건 byte만 읽기 때문에 누군가는 문자를 바이트로, 바이트를 문자로 바꿔줘야 한다.
이 역할을 OutputStreamWriter, InputStreamReader가 한다.
```java
public class ReaderWriterMainV2 {
    public static void main(String[] args) throws IOException {
        String writeString = "ABC";
        System.out.println("write String: " + writeString);
  
        // 파일에 쓰기
        FileOutputStream fos = new FileOutputStream(FILE_NAME);
        OutputStreamWriter osw = new OutputStreamWriter(fos, UTF_8);
  
        osw.write(writeString);
        osw.close();
  
        // 파일에서 읽기
        FileInputStream fis = new FileInputStream(FILE_NAME);
        InputStreamReader isr = new InputStreamReader(fis, UTF_8);
  
        StringBuilder content = new StringBuilder();
        int ch;
        while((ch = isr.read()) != -1) {
            content.append((char) ch);
        }
        isr.close();
  
        System.out.println("read String: " + content);
    }
}
```
# #️⃣ 생각해볼 문제
# 💫 학습자료