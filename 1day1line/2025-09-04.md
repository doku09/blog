# ✏️ 학습내용
## 네트워크 프로그램6 - 자원정리3 
클라이언트가 서버소켓에 접근 할때 소켓과 inputstream, outputstream을 관리하기 위해 Session 객체를 활용하였다. 
하나의 세션이 종료되면 try-with-resource를 사용하여 자원을 정리한다. 
```java
try(
    Socket socket = new Socket("localhost", PORT);
    DataInputStream input = new DataInputStream(socket.getInputStream());
    DataOutputStream output = new DataOutputStream(socket.getOutputStream())) {...}
```
그러나 외부에서 자원을 정리해야하는 상황이라면 try-with-resource를 사용하지 못한다. 
외부에서 자원을 정리하는 경우란 만약 각각의 세션이 아닌 서버를 종료해야할 경우 각각의 세션을 모두 종료해야하는데, 이때는 세션의 의지와 상관없이 종료해야한다. 
이러한 종료처리를 하기위해 SessionManager를 사용한다. 
```java
// 동시성 처리
public class SessionManagerV6 {

 private List<SessionV6> sessions = new ArrayList<>();

 public synchronized void add(SessionV6 session) {
    sessions.add(session);
 }

 public synchronized void remove(SessionV6 session) {
    sessions.remove(session);
 }

 public synchronized void closeAll() {
    for (SessionV6 session : sessions) {
    session.close();
    }
    sessions.clear();
 }
}
```
closeAll()을 사용하여 모든 session을 닫아주는 것 처럼, 세션을 외부에서도 종료시키기 위해 try-with-resource를 사용하지 않고 세션 멤버변수로 자원을 둔다.

```java
public class Session implements Runnable {
 private final Socket socket;
 private final DataInputStream input;
 private final DataOutputStream output;
 private final SessionManagerV6 sessionManager;
 private boolean closed = false;

 public Session(Socket socket, SessionManagerV6 sessionManager) throws
IOException {
    this.socket = socket;
    this.input = new DataInputStream(socket.getInputStream());
    this.output = new DataOutputStream(socket.getOutputStream());
    this.sessionManager = sessionManager;
    this.sessionManager.add(this);
 }
```
이렇게 try-resource를 사용하지 않아야 외부에서도 자원을 정리할 수 있다!

# #️⃣ 생각해볼 문제
# 💫 학습자료