# 트랜잭션 격리 수준
- 트랜잭션 격리수준이랑 여러 트랜잭션이 처리 될때, 트랜잭션끼리 얼마나 서로 고립되어 있는지를 나타낸다. 
- 즉, 특정 트랜잭션이 다른 트랜잭션에 변경한 데이터를 볼 수 있도록 허용할지 말지를 결정함. 

격리수준은 아래 4개로 나눈다.

## READ UNCOMMITTED
    - 어떤 트랜잭션의 변경 내용이 commit이나 rollback 상관없이 다른 트랜잭션에 보인다. 
    > Dirty Read라고도 불림
    > 1. A트랜잭션에서 10번 사원의 나이를 27살->28살로 변경
    > 2. 아직 커밋되지 않음
    > 3. 28살이 조회됨 

## READ COMMITTED (Oracle)
    - 어떤 트랜잭션의 변경이 커밋되어야만 다른 트랜잭션에서 조회가능, 온라인서비스에서 가장 많이 선택되는 격리수준이다. 
    > B트랜잭션에서 10번 사원의 나이를 조회해도 27살이 된다. (undo 영역에 저장. MVCC 참조)
    - 언뜻 정합성 문제가 해결된것처럼 보이지만, `NON_REPEATABLE READ` 부정합 문제가 발생할수 있다.

```
Non-Repeatable Read란?

1. B 트랜잭션에서 10번 사원의 나이를 조회
2. 27살이 조회됨
3. A 트랜잭션에서 10번 사원의 나이를 27살에서 28살로 바꾸고 커밋
4. B 트랜잭션에서 10번 사원의 나이를 다시 조회
5. 28살이 조회됨

- 트랜잭션 B가 같은 데이터를 두번 조회 했는데, 그 사이에 트랜잭션 A가 데이터를 바꿔서 결과가 달라진 경우
- B 트랜잭션 안에서 같은 쿼리를 두번 실행했는데 결과가 다름. 
- 일관성깨진다.(REPEATABLE 하지 않음)
```
## REPEATABLE READ (mysql)
    - 트랜잭션이 시작되기 전에 커밋된 내용에 대해서만 조회할 수 있는 격리수준이다.
    > 1. 1번 트랜잭션이 1번 사원조회
    > 2. 2번 트랜잭션이 1번사원의 이름을 변경하고 커밋
    > 3. 1번 트랜잭션에서 1번 사원을 다시조회
    > 4. undo 영역에 백업된 데이터 반환? 

자신의 트랜잭션 번호보다 낮은 트랜잭션 번호에서 커밋된 내용만 보게한다. 
    > 1번 트랜잭션은 2번보다 낮으므로 2번에서 변경된 내용은 추적하지 않아서 2번이 변경한 내용을 보여주지 않는다.
- SERIALIZABLE
아래로 내려갈수록 트랜잭션간 고립정도가 높아지고 성능이 떨어지는것이 일반적이다.

# MVCC(다중 버전 동시성 제어)
-Multi-Version Concurrency Control

# 동시성제어 
다수 사용자의 동시접속을 위해 DBMS는 동시성을 제어할 수 있도록 락(Lock)과 SET TRANSACTION 명령어를 이용해 트랜잭션 격리성 수준을 조정할 수 있는 기능을 제공한다. 
이렇게 동시성을 제어하는 방법으로는 **낙관적 동시성 제어**와 **비관적 동시성 제어**가 있다.

## 낙관적 동시성 제어(Optimistic Concurrency Control)
- 사용자들이 동시에 데이터를 수정하지 않을 것이라고 가정
- 데이터를 읽는 시점에 Lock을 걸지 않고 수정시점에 값이 변경되었는지를 반드시 검사한다.

## 비관적 동시성 제어(Pessimistic Concurrency Control)
- 사용자들이 같은 데이터를 동시에 수정할 것이라고 가정
- 데이터를 읽는 시점에 Lock을 걸고, 트랜잭션이 완료될때까지 유지
- SELECT 시점에 Lock을 거는 비관적 동시성 제어는 시스템의 동시성을 심각하게 떨어뜨릴 수 있어서 wait 또는 nowait 옵션과 함께 사용해야 함

동시성 제어의 목표는 동시에 실행되는 트랜잭션 수를 최대화 하면서 입력, 수정, 삭제, 검색 시 데이터의 무결성을 유지하는데 있다. 따라서 동시 업데이트가 거의 없는 경우라면 낙관적 잠금을 사용하면 되지만, 그렇지 않다면 비관적 제어를 사용해야 한다.

비관적 동시성 제어를 위한 대표적인 방법으로 Lock이 있는데 크게 두가지가 있다.
### 공유락 (Shared Lock)
### 배타락 (Exclusive Lock) 


출처: https://mangkyu.tistory.com/53 [MangKyu's Diary:티스토리]

