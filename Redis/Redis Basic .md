# Redis란?
- Redis : Remote Dictionary Server 
- Key-Value 구조의 비정형 데이터를 저장하고 관리하기 위한 오픈소스 기반의 NoSQL DBMS
- 사용에 따라 데이터베이스로 사용될 수도 있고, Cache Server로 사용될 수도 있음

## Redis 사용 이유
- 데이터베이스는 데이터를 물리 디스크에 직접 쓰기 때문에 서버에 문제가 발생하여 다운되더라도 데이터가 손실되지 않음
- 하지만 매번 디스크에 접근하기 때문에 사용자가 많아질수록 부하 증가
- 이때 Cache Server를 도입하여 사용하고, Cache Server로 Redis를 이용할 수 있음
- Cache Server 사용 시 같은 요청에 매번 데이터베이스를 거치는 것이 아닌, Cache Server에서 첫 번째 요청 이후 저장된 결과값을 바로 반환
- 데이터베이스 부하 감소 가능, 서비스 속도 향상
- 단일스레드로 동시성 제어가능

## Redis의 특징과 장점
- Key, Value 구조이기 때문에 쿼리를 사용할 필요가 없음
    - 고정되지 않은 스키마를 가지므로 키마다 원하는 내용만 저장 가능
- In-Memory 데이터베이스
    - 매우 빠름
    - 서버 재시작 시 모든 데이터 유실
    - 복제 기능이 있지만 사람의 실수에는 복원 불가
    - 백업이 필요할 수 있음 (persist option 지원)
- 다양한 자료구조를 제공
    - String, List, Hash, Set, Sorted Set, Stream 등
    - 사용 용이, 개발 편의성 증대
    - application 단에서 필요한 로직을 DB 단에서 줄일 수 있음
    - list형 데이터 입력/삭제가 MySQL에 비해 10배 빠름
- Single Thread로 동작
    - 한 번에 여러 클라이언트의 요청을 수행할 수 없음
    - 한 클라이언트가 오래 걸리는 작업을 요청하면 장애가 발생할 수 있음
- 여러 대의 서버 구성 가능 (Master-Slave)
- Database, Cache, Message broker로 사용됨
    - Cache로 사용 시 무조건 TTL로 사용. 시간 중요
<br><br>

> # TTL이란?
Redis는 특정 시간 동안만 데이터가 저장되는 TTL(Time To Live) 기능을 'expire'라는 명칭으로 제공한다. JWT refresh token을 저장할 때 처럼 일정한 시간 동안만 데이터를 저장해야 하는 경우에 해당 기능이 유용하게 사용된다.

## TTL 동작 과정
Redis는 수동적인 만료와 능동적인 만료를 지원한다.

- 수동적인 만료
    - 액세스를 시도할 때까지 실제로 키를 만료(삭제)하지 않는다. 키를 읽을 때마다 키가 이미 만료되었는지 확인하고 만료된 경우 자동으로 null키를 반환하고 삭제한다.
    - 구현이 단순하다는 장점이 있다.
    - 하지만 키에 접근하지 않으면 영원히 만료되지 않으며 계속해서 메모리 공간을 차지한다는 치명적인 단점이 있다. 그래서 수동적인 만료의 단점을 보완하기 위한 것이 능동적인 만료이다.
- 능동적인 만료
    - 주기적으로 무작위의 몇 개의 키를 확인하고 만료된 키가 있으면 계속 진행하며 키를 제거한다.
    - 구체적인 예시는 다음과 같다.
    
> Redis가 초당 10회로 다음 작업을 수행한다.
> 1. TTL이 첨부된 임의의 키 20개를 테스트한다.
> 2. 20개 중 만료된 모든 키를 삭제한다.
> 3. 20개 중 25% 이상이 만료된 경우, 1단계를 반복한다.

간단히 말하자면 확률 알고리즘을 활용하여 만료된 키의 비율을 확인하고 만료된 키가 많다면 무작위로 키를 확인하고 필요에 따라 만료하는 작업을 반복한다.


>출처  
https://velog.io/@inhwa1025/Redis-Redis%EB%9E%80-Redis%EC%9D%98-%EA%B0%9C%EB%85%90%EA%B3%BC-%ED%8A%B9%EC%A7%95  
>https://redis.io/docs/latest/